<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>SecureUSB â€” File Encrypt</title>
<style>
/* Full CSS copied from your previous project */
body{
    font-family: 'Courier New', monospace;
    margin:0; padding:0;
    min-height:100vh;
    display:flex; flex-direction:column;
    align-items:center; justify-content:flex-start;
    background-color:#000;
    color:#0f0;
    background-image: url('background.png');
    background-repeat: no-repeat;
    background-position: right bottom;
    background-size: contain;
}
h1{ font-size:28px; margin:20px 0; color:rgb(0, 255, 98); text-shadow: 0 0 10px rgb(0, 255, 13), 0 0 20px rgb(21, 255, 0); }
.card{ background: rgba(0,0,0,0.8); border: 1px solid #0f0; border-left: 5px solid rgb(4, 255, 0); border-radius:10px; padding:20px; margin-bottom:20px; width:90%; max-width:500px; box-shadow: 0 0 20px #0f0; transform: translateY(-20px); opacity:0; animation: slideUp 1s forwards; }
input, button{ padding:12px; margin-top:10px; width:100%; border-radius:8px; border:1px solid #0f0; background: rgba(0,0,0,0.7); color:#0f0; font-size:16px; }
.card input[type="text"], .card input[type="password"] { padding-right: 4px; padding-left: 12px; padding-top: 12px; padding-bottom: 12px; width: 100%; box-sizing: border-box; }
input:focus{ background: rgba(0,0,0,0.9); outline:2px solid rgb(0, 255, 34); }
button{ background: linear-gradient(90deg,rgb(0, 255, 60),#0f0); color:#000; font-weight:bold; cursor:pointer; transition: transform 0.2s, box-shadow 0.2s; }
button:hover{ transform: scale(1.05); box-shadow: 0 0 15px rgb(0, 255, 30), 0 0 15px #0f0; }
pre{ background: rgba(0,0,0,0.6); padding:10px; border-radius:8px; max-height:150px; overflow:auto; font-size:14px; color:#0f0; border: 1px solid #0f0; }
@keyframes slideUp{ to {transform: translateY(0); opacity:1;} }
@media (max-width: 600px) { body { background-size: cover; background-position: center bottom; padding: 0 2vw; } .card { width: 100%; max-width: 100%; padding: 12px; margin-bottom: 16px; box-sizing: border-box; } h1 { font-size: 20px; margin: 14px 0; word-break: break-word; text-align: center; } input, button { font-size: 15px; padding: 10px; } pre { font-size: 12px; padding: 7px; max-height: 100px; } }
@media (max-width: 400px) { h1 { font-size: 16px; } .card { padding: 8px; } input, button { font-size: 13px; padding: 8px; } }
</style>
</head>
<body>

<h1>ðŸ”’ SecureUSB â€” File Encrypt</h1>

<div id="loginScreen" class="card">
  <label>Username</label>
  <input id="username" type="text" placeholder="Enter username"/>
  <label>Password</label>
  <input id="password" type="password" placeholder="Enter password"/>
  <button id="loginBtn">Login</button>
  <pre id="loginLog"></pre>
</div>

<div id="fileScreen" style="display:none;">
  <div class="card">
    <label>Choose file to encrypt</label>
    <input id="fileInput" type="file"/>
    <label>Encryption password</label>
    <input id="filePwd" type="password" placeholder="Enter a password to encrypt the file"/>
    <button id="encryptBtn">Encrypt File</button>
  </div>
  <div class="card">
    <h3>Activity Log</h3>
    <pre id="log">Ready to encrypt...</pre>
  </div>
</div>

<script>
(async ()=>{
const loginLog = document.getElementById('loginLog');
const logEl = document.getElementById('log');
function log(s){ logEl.textContent = new Date().toISOString() + " â€” " + s + "\n" + logEl.textContent; }
function loginLogMsg(s){ loginLog.textContent = s; }

// Sounds (same as index)
const soundEncrypt = new Audio('sounds/encrypt.mp3');
const soundDecrypt = new Audio('sounds/decrypt.mp3');
const soundError = new Audio('sounds/error.mp3');

// correct hash for login
const correctHash = "401edffe6c03b2bb21cd75fb4916e8a747587be0f5dd03c6b3edb6487c9faac7";

// SHA-256
async function sha256Hex(str){
  const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str));
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

// derive AES key
async function deriveKey(password, salt){
  const enc = new TextEncoder();
  const passKey = await crypto.subtle.importKey('raw', enc.encode(password), {name:'PBKDF2'}, false, ['deriveKey']);
  const key = await crypto.subtle.deriveKey(
    {name:'PBKDF2', salt: salt, iterations: 150000, hash: 'SHA-256'},
    passKey,
    { name: 'AES-CBC', length: 256},
    false,
    ['encrypt','decrypt']
  );
  return key;
}

function concatBuffers(a,b){ let c=new Uint8Array(a.byteLength+b.byteLength); c.set(new Uint8Array(a),0); c.set(new Uint8Array(b),a.byteLength); return c.buffer; }

function downloadBlob(blob, filename){
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

// encrypt file
async function encryptFile(file, password){
  log("Starting encryption: " + file.name);
  const arrayBuffer = await file.arrayBuffer();
  const salt = crypto.getRandomValues(new Uint8Array(16));
  const iv = crypto.getRandomValues(new Uint8Array(16));
  const key = await deriveKey(password, salt);
  const encrypted = await crypto.subtle.encrypt({name:'AES-CBC', iv: iv}, key, arrayBuffer);
  const finalData = concatBuffers(concatBuffers(salt.buffer, iv.buffer), encrypted);
  const blob = new Blob([finalData], {type:'application/octet-stream'});
  downloadBlob(blob, file.name + ".enc");
  log("Encryption complete: " + file.name + ".enc");
  soundEncrypt.play();
}

document.getElementById('loginBtn').addEventListener('click', async ()=>{
  const user = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value.trim();
  const hash = await sha256Hex(user + pass);
  if(hash === correctHash){
    loginLogMsg("Login successful âœ…");
    document.getElementById('loginScreen').style.display = "none";
    document.getElementById('fileScreen').style.display = "block";
  } else {
    loginLogMsg("Incorrect username or password âŒ");
    soundError.play();
  }
});

document.getElementById('encryptBtn').addEventListener('click', async ()=>{
  const file = document.getElementById('fileInput').files[0];
  const pwd = document.getElementById('filePwd').value.trim();
  if(!file){ log("Select a file first"); soundError.play(); return; }
  if(!pwd){ log("Enter an encryption password"); soundError.play(); return; }
  encryptFile(file, pwd);
});
})();
</script>

</body>
</html>
